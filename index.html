<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JagdBallistik Pro - Wiederlade-Rechner für Jäger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c3a 50%, #1a4d2e 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.2);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: #fff;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            color: #d4f4dd;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            border: 2px solid rgba(77, 124, 58, 0.3);
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(77, 124, 58, 0.6);
        }

        .card h2 {
            color: #2d5016;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 3px solid #4a7c3a;
            padding-bottom: 10px;
            font-weight: bold;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d5016;
            font-size: 0.9rem;
        }

        select, input {
            padding: 10px;
            border: 2px solid #d4f4dd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #4a7c3a;
            box-shadow: 0 0 0 3px rgba(74, 124, 58, 0.1);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #4a7c3a 0%, #2d5016 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 124, 58, 0.4);
        }

        .results-section {
            grid-column: 1 / -1;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #4a7c3a 0%, #2d5016 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .result-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .result-unit {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .chart-container {
            margin-top: 20px;
        }

        .chart-tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 5px;
        }

        .tab-btn {
            background: #d4f4dd;
            border: 2px solid #4a7c3a;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #2d5016;
            font-weight: 600;
        }

        .tab-btn.active {
            background: #4a7c3a;
            color: white;
        }

        .chart-area {
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: 450px;
            position: relative;
            border: 2px solid #4a7c3a;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .warning {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .warning h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .hunting-badge {
            display: inline-block;
            background: #4a7c3a;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: bold;
        }

        .advanced-section {
            background: rgba(212, 244, 221, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .unit-display {
            font-size: 0.8rem;
            color: #666;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🦌 JagdBallistik Pro</h1>
            <p>Präzisions-Wiederlade-Rechner für anspruchsvolle Jäger und Sportschützen</p>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>🎯 Kaliber & Geschoss-Auswahl <span class="hunting-badge">Basis</span></h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cartridge">Jagdkaliber</label>
                        <select id="cartridge">
                            <optgroup label="Klassische Jagdkaliber">
                                <option value="308win">.308 Winchester</option>
                                <option value="30-06">.30-06 Springfield</option>
                                <option value="270win">.270 Winchester</option>
                                <option value="7x64">7x64 Brenneke</option>
                                <option value="8x57js">8x57 IS</option>
                                <option value="9.3x62">9,3x62 Mauser</option>
                            </optgroup>
                            <optgroup label="Raubwild & Langdistanz">
                                <option value="223rem">.223 Remington</option>
                                <option value="22-250">.22-250 Remington</option>
                                <option value="243win">.243 Winchester</option>
                                <option value="6.5cm">6,5 Creedmoor</option>
                                <option value="7mmrem">7mm Rem Mag</option>
                                <option value="300wm">.300 Win Mag</option>
                                <option value="338lap">.338 Lapua Mag</option>
                            </optgroup>
                            <optgroup label="Schweres Wild">
                                <option value="375h&h">.375 H&H Magnum</option>
                                <option value="416rem">.416 Remington</option>
                                <option value="458wm">.458 Winchester</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bullet">Geschoss-Typ</label>
                        <select id="bullet">
                            <optgroup label="Teilmantel (Jagd)">
                                <option value="150psp">150gr PSP Weichspitz</option>
                                <option value="165psp">165gr PSP Weichspitz</option>
                                <option value="180psp">180gr PSP Weichspitz</option>
                            </optgroup>
                            <optgroup label="Vollmantel (Match)">
                                <option value="168hpbt">168gr HPBT Match</option>
                                <option value="175smk">175gr SMK Match</option>
                                <option value="190vld">190gr VLD Match</option>
                            </optgroup>
                            <optgroup label="Monolithisch">
                                <option value="150mono">150gr Mono Kupfer</option>
                                <option value="168mono">168gr Mono Kupfer</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="bulletWeight">Geschossgewicht <span class="unit-display">(Grain)</span></label>
                        <input type="number" id="bulletWeight" value="168" min="40" max="400" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="bulletDiameter">Geschoss-Ø <span class="unit-display">(mm)</span></label>
                        <input type="number" id="bulletDiameter" value="7.82" step="0.001" min="5.5" max="12">
                    </div>

                    <div class="form-group">
                        <label for="bulletLength">Geschosslänge <span class="unit-display">(mm)</span></label>
                        <input type="number" id="bulletLength" value="28.5" step="0.1" min="10" max="50">
                    </div>

                    <div class="form-group">
                        <label for="ballisticCoeff">Ballistischer Koeffizient (BC)</label>
                        <input type="number" id="ballisticCoeff" value="0.462" step="0.001" min="0.1" max="1.0">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>📐 Hülsen-Geometrie <span class="hunting-badge">Präzision</span></h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="caseLength">Hülsenlänge <span class="unit-display">(mm)</span></label>
                        <input type="number" id="caseLength" value="51.18" step="0.01" min="20" max="80">
                    </div>

                    <div class="form-group">
                        <label for="cartridgeLength">Patronenlänge gesamt <span class="unit-display">(mm)</span></label>
                        <input type="number" id="cartridgeLength" value="78.0" step="0.1" min="40" max="120">
                    </div>

                    <div class="form-group">
                        <label for="seatingDepth">Setztiefe <span class="unit-display">(mm)</span></label>
                        <input type="number" id="seatingDepth" value="16.31" step="0.01" min="5" max="30">
                    </div>

                    <div class="form-group">
                        <label for="shankSeatDepth">Schaft-Setztiefe <span class="unit-display">(mm)</span></label>
                        <input type="number" id="shankSeatDepth" value="13.81" step="0.01" min="3" max="25">
                    </div>

                    <div class="form-group">
                        <label for="caseCapacity">Max. Hülsenvolumen <span class="unit-display">(gr H2O)</span></label>
                        <input type="number" id="caseCapacity" value="56.0" step="0.1" min="20" max="120">
                    </div>

                    <div class="form-group">
                        <label for="usableCaseCapacity">Nutzbares Volumen <span class="unit-display">(gr H2O)</span></label>
                        <input type="number" id="usableCaseCapacity" value="45.2" step="0.1" min="15" max="100">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>🔫 Lauf-Spezifikationen <span class="hunting-badge">Waffe</span></h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="barrelLength">Lauflänge <span class="unit-display">(Zoll)</span></label>
                        <input type="number" id="barrelLength" value="24.0" min="16" max="32" step="0.5">
                    </div>

                    <div class="form-group">
                        <label for="grooveCaliberBore">Felddurchmesser <span class="unit-display">(mm)</span></label>
                        <input type="number" id="grooveCaliberBore" value="7.62" step="0.001" min="5" max="12">
                    </div>

                    <div class="form-group">
                        <label for="grooveCaliberGroove">Zugdurchmesser <span class="unit-display">(mm)</span></label>
                        <input type="number" id="grooveCaliberGroove" value="7.82" step="0.001" min="5" max="12">
                    </div>

                    <div class="form-group">
                        <label for="riflingTwist">Drallsteigung <span class="unit-display">(1 in Zoll)</span></label>
                        <input type="number" id="riflingTwist" value="11.25" step="0.25" min="7" max="18">
                    </div>

                    <div class="form-group">
                        <label for="freeBore">Freie Lauflänge <span class="unit-display">(mm)</span></label>
                        <input type="number" id="freeBore" value="1.5" step="0.1" min="0" max="10">
                    </div>

                    <div class="form-group">
                        <label for="crossSectionalBoreArea">Querschnittsfläche <span class="unit-display">(mm²)</span></label>
                        <input type="number" id="crossSectionalBoreArea" value="45.6" step="0.1" min="20" max="120">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>🧪 Pulver-Eigenschaften <span class="hunting-badge">Treibladung</span></h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="powder">Pulversorte</label>
                        <select id="powder">
                            <optgroup label="Vihtavuori">
                                <option value="n140">N140 (mittelschnell)</option>
                                <option value="n150">N150 (mittel)</option>
                                <option value="n160">N160 (langsam)</option>
                                <option value="n165">N165 (sehr langsam)</option>
                            </optgroup>
                            <optgroup label="Hodgdon">
                                <option value="varget">Varget (Allround)</option>
                                <option value="h4350">H4350 (Magnum)</option>
                                <option value="h4831">H4831 (Magnum lang)</option>
                                <option value="h1000">H1000 (Ultra Magnum)</option>
                            </optgroup>
                            <optgroup label="IMR">
                                <option value="imr4064">IMR 4064 (klassisch)</option>
                                <option value="imr4350">IMR 4350 (Magnum)</option>
                                <option value="imr4831">IMR 4831 (langsam)</option>
                                <option value="imr7828">IMR 7828 (sehr langsam)</option>
                            </optgroup>
                            <optgroup label="Alliant">
                                <option value="rl15">RL-15 (mittel)</option>
                                <option value="rl19">RL-19 (langsam)</option>
                                <option value="rl22">RL-22 (Magnum)</option>
                                <option value="rl25">RL-25 (Ultra Magnum)</option>
                            </optgroup>
                            <optgroup label="Norma">
                                <option value="norma203">Norma 203-B</option>
                                <option value="norma204">Norma 204</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="chargeWeight">Ladungsmenge <span class="unit-display">(Grain)</span></label>
                        <input type="number" id="chargeWeight" value="42.5" step="0.1" min="15" max="100">
                    </div>

                    <div class="form-group">
                        <label for="burningRateFactor">Abbrandrate-Faktor</label>
                        <input type="number" id="burningRateFactor" value="0.388" step="0.001" min="0.1" max="1.0">
                    </div>

                    <div class="form-group">
                        <label for="progressiveBurningLimit">Progressive Abbrandgrenze <span class="unit-display">(%)</span></label>
                        <input type="number" id="progressiveBurningLimit" value="21" step="1" min="5" max="50">
                    </div>

                    <div class="form-group">
                        <label for="propellantDensity">Pulverdichte <span class="unit-display">(g/cm³)</span></label>
                        <input type="number" id="propellantDensity" value="1.61" step="0.01" min="0.8" max="2.0">
                    </div>

                    <div class="form-group">
                        <label for="weightingFactor">Gewichtungsfaktor</label>
                        <input type="number" id="weightingFactor" value="0.5" step="0.1" min="0.1" max="1.0">
                    </div>
                </div>

                <div class="advanced-section">
                    <h3>🔬 Erweiterte Pulver-Parameter</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="heatOfExplosion">Explosionswärme <span class="unit-display">(kJ/kg)</span></label>
                            <input type="number" id="heatOfExplosion" value="3935" step="10" min="3000" max="5000">
                        </div>

                        <div class="form-group">
                            <label for="ratioSpecificHeats">Verhältnis spez. Wärmen</label>
                            <input type="number" id="ratioSpecificHeats" value="1.231" step="0.001" min="1.1" max="1.4">
                        </div>

                        <div class="form-group">
                            <label for="startPressure">Anzünderdruck <span class="unit-display">(bar)</span></label>
                            <input type="number" id="startPressure" value="250" step="10" min="100" max="500">
                        </div>

                        <div class="form-group">
                            <label for="covolume">Covolumen <span class="unit-display">(l/kg)</span></label>
                            <input type="number" id="covolume" value="1.0" step="0.01" min="0.5" max="2.0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>🌡️ Umgebungsbedingungen <span class="hunting-badge">Jagd</span></h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="temperature">Temperatur <span class="unit-display">(°C)</span></label>
                        <input type="number" id="temperature" value="20" min="-30" max="50">
                    </div>

                    <div class="form-group">
                        <label for="humidity">Luftfeuchtigkeit <span class="unit-display">(%)</span></label>
                        <input type="number" id="humidity" value="60" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label for="pressure">Luftdruck <span class="unit-display">(hPa)</span></label>
                        <input type="number" id="pressure" value="1013" min="900" max="1100">
                    </div>

                    <div class="form-group">
                        <label for="altitude">Höhe über NN <span class="unit-display">(m)</span></label>
                        <input type="number" id="altitude" value="300" min="0" max="3000">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculate()">
                    🎯 Ballistische Analyse starten
                </button>
            </div>

            <div class="card results-section">
                <h2>📊 Berechnungsergebnisse <span class="hunting-badge">Analyse</span></h2>
                <div id="results" style="display: none;">
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value" id="velocity">0</div>
                            <div class="result-unit">m/s V₀ (Mündung)</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="pressure">0</div>
                            <div class="result-unit">bar Max. Gasdruck</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="energy">0</div>
                            <div class="result-unit">Joule E₀ (Mündung)</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="loadDensity">0</div>
                            <div class="result-unit">% Ladungsdichte</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="muzzlePressure">0</div>
                            <div class="result-unit">bar Mündungsdruck</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="burnTime">0</div>
                            <div class="result-unit">ms Abbrandzeit</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="projectileEnergy">0</div>
                            <div class="result-unit">J Geschossenergie</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="ballisticEfficiency">0</div>
                            <div class="result-unit">% Ball. Wirkungsgrad</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container" id="chartContainer" style="display: none;">
                    <div class="chart-tabs">
                        <button class="tab-btn active" onclick="showChart('pressure')">Druckverlauf</button>
                        <button class="tab-btn" onclick="showChart('velocity')">Geschwindigkeitsverlauf</button>
                        <button class="tab-btn" onclick="showChart('energy')">Energieverlauf</button>
                        <button class="tab-btn" onclick="showChart('trajectory')">Flugbahn</button>
                    </div>
                    <div class="chart-area">
                        <canvas id="chartCanvas"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="warning">
            <h3>⚠️ WICHTIGER SICHERHEITSHINWEIS FÜR JÄGER</h3>
            <p><strong>ACHTUNG WAIDMANN!</strong> Diese Berechnungen sind theoretische Richtwerte und ersetzen NIEMALS die offiziellen Ladedaten aus Wiederladehandbüchern renommierter Hersteller wie Hornady, Sierra, Nosler oder Vihtavuori! 
            <br><br>
            <strong>Sicherheitsregeln beim Wiederladen:</strong><br>
            • Beginne IMMER mit 10% reduzierten Startladungen<br>
            • Arbeite dich in 0,5gr Schritten zur Maximalladung vor<br>
            • Beachte Zeichen von Überdruck (schwere Hülsenöffnung, abgeflachte Zündkappenabdrücke)<br>
            • Verwende ausschließlich die angegebenen Komponenten<br>
            • Führe ein Ladeprotokoll und teste jeden Ladungswechsel gründlich<br>
            <br>
            <em>Waidmannsheil und sicheres Wiederladen!</em></p>
        </div>
    </div>

    <script>
        // Erweiterte Pulverdatenbank mit realistischen Werten
        const powderData = {
            // Vihtavuori
            'n140': { burnRate: 0.92, density: 0.95, energy: 3850, ba: 0.385, progressiveLimit: 18 },
            'n150': { burnRate: 0.85, density: 0.93, energy: 3890, ba: 0.390, progressiveLimit: 20 },
            'n160': { burnRate: 0.78, density: 0.92, energy: 3920, ba: 0.395, progressiveLimit: 22 },
            'n165': { burnRate: 0.72, density: 0.91, energy: 3940, ba: 0.400, progressiveLimit: 25 },
            
            // Hodgdon
            'varget': { burnRate: 0.85, density: 0.95, energy: 3800, ba: 0.388, progressiveLimit: 21 },
            'h4350': { burnRate: 0.78, density: 0.92, energy: 3750, ba: 0.392, progressiveLimit: 23 },
            'h4831': { burnRate: 0.70, density: 0.90, energy: 3720, ba: 0.398, progressiveLimit: 26 },
            'h1000': { burnRate: 0.65, density: 0.89, energy: 3650, ba: 0.405, progressiveLimit: 28 },
            
            // IMR
            'imr4064': { burnRate: 0.88, density: 0.94, energy: 3850, ba: 0.386, progressiveLimit: 19 },
            'imr4350': { burnRate: 0.80, density: 0.93, energy: 3780, ba: 0.390, progressiveLimit: 22 },
            'imr4831': { burnRate: 0.73, density: 0.91, energy: 3740, ba: 0.396, progressiveLimit: 24 },
            'imr7828': { burnRate: 0.67, density: 0.88, energy: 3680, ba: 0.402, progressiveLimit: 27 },
            
            // Alliant
            'rl15': { burnRate: 0.86, density: 0.96, energy: 3820, ba: 0.388, progressiveLimit: 20 },
            'rl19': { burnRate: 0.76, density: 0.93, energy: 3760, ba: 0.394, progressiveLimit: 23 },
            'rl22': { burnRate: 0.72, density: 0.90, energy: 3700, ba: 0.398, progressiveLimit: 25 },
            'rl25': { burnRate: 0.68, density: 0.87, energy: 3640, ba: 0.404, progressiveLimit: 28 },
            
            // Norma
            'norma203': { burnRate: 0.84, density: 0.94, energy: 3840, ba: 0.389, progressiveLimit: 21 },
            'norma204': { burnRate: 0.79, density: 0.92, energy: 3780, ba: 0.393, progressiveLimit: 23 }
        };

        let currentChart = 'pressure';
        let chartData = {};

        function calculate() {
            // Alle Eingabewerte sammeln
            const bulletWeight = parseFloat(document.getElementById('bulletWeight').value);
            const chargeWeight = parseFloat(document.getElementById('chargeWeight').value);
            const barrelLength = parseFloat(document.getElementById('barrelLength').value);
            const caseCapacity = parseFloat(document.getElementById('caseCapacity').value);
            const usableCaseCapacity = parseFloat(document.getElementById('usableCaseCapacity').value);
            const startPressure = parseFloat(document.getElementById('startPressure').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            const humidity = parseFloat(document.getElementById('humidity').value);
            const pressure = parseFloat(document.getElementById('pressure').value);
            const altitude = parseFloat(document.getElementById('altitude').value);
            const powder = document.getElementById('powder').value;
            const bulletDiameter = parseFloat(document.getElementById('bulletDiameter').value);
            const seatingDepth = parseFloat(document.getElementById('seatingDepth').value);
            const crossSectionalBoreArea = parseFloat(document.getElementById('crossSectionalBoreArea').value);

            // Umgebungskorrektur
            const tempFactor = 1 + (temperature - 15) * 0.0025;
            const altitudeFactor = 1 - (altitude * 0.000012);
            const humidityFactor = 1 - (humidity - 50) * 0.0002;
            
            // Pulvereigenschaften
            const powderProps = powderData[powder];
            
            // Ladungsdichte berechnen
            const loadDensity = (chargeWeight * powderProps.density) / usableCaseCapacity * 100;
            
            // Erweiterte Druckberechnung
            const densityFactor = Math.pow(loadDensity / 100, 1.7);
            const burnRateAdjustment = powderProps.burnRate * tempFactor;
            const pressureFactor = densityFactor * burnRateAdjustment * tempFactor * altitudeFactor;
            
            const maxPressure = startPressure + (chargeWeight * powderProps.ba * 8000 * pressureFactor);
            
            // Realistische V0-Berechnung mit Barrel-Zeit-Analyse
            const barrelTimeMs = (barrelLength * 25.4) / (burnRateAdjustment * 800 + 400);
            const expansionRatio = Math.pow((crossSectionalBoreArea * barrelLength * 25.4) / usableCaseCapacity, 0.3);
            
            const velocityBase = Math.sqrt(2 * powderProps.energy * chargeWeight * 0.0648 / (bulletWeight * 0.0648));
            const barrelEfficiency = Math.min(1.0, barrelLength / 24);
            const pressureEfficiency = Math.pow(maxPressure / 3000, 0.4);
            
            const velocity = velocityBase * barrelEfficiency * pressureEfficiency * expansionRatio * humidityFactor;
            
            // Mündungsdruck (vereinfacht)
            const muzzlePressure = maxPressure * 0.15 * Math.exp(-barrelLength / 30);
            
            // Energien berechnen
            const bulletMass = bulletWeight * 0.0648; // Gramm
            const muzzleEnergy = 0.5 * bulletMass * Math.pow(velocity, 2);
            const powderEnergy = chargeWeight * 0.0648 * powderProps.energy;
            const ballisticEfficiency = (muzzleEnergy / powderEnergy) * 100;
            
            // Ergebnisse anzeigen
            document.getElementById('velocity').textContent = Math.round(velocity);
            document.getElementById('pressure').textContent = Math.round(maxPressure);
            document.getElementById('energy').textContent = Math.round(muzzleEnergy);
            document.getElementById('loadDensity').textContent = loadDensity.toFixed(1);
            document.getElementById('muzzlePressure').textContent = Math.round(muzzlePressure);
            document.getElementById('burnTime').textContent = barrelTimeMs.toFixed(2);
            document.getElementById('projectileEnergy').textContent = Math.round(muzzleEnergy);
            document.getElementById('ballisticEfficiency').textContent = ballisticEfficiency.toFixed(1);
            
            document.getElementById('results').style.display = 'block';
            document.getElementById('chartContainer').style.display = 'block';

            // Diagrammdaten generieren
            generateAdvancedChartData(velocity, maxPressure, muzzlePressure, barrelLength, muzzleEnergy);
            drawChart();
        }

        function generateAdvancedChartData(maxVelocity, maxPressure, muzzlePressure, barrelLength, maxEnergy) {
            const points = 100;
            chartData.pressure = [];
            chartData.velocity = [];
            chartData.energy = [];
            chartData.trajectory = [];

            for (let i = 0; i <= points; i++) {
                const position = (i / points) * barrelLength * 25.4; // mm
                const relativePos = i / points;
                
                // Realistischer Druckverlauf
                let pressure;
                if (relativePos < 0.05) {
                    pressure = maxPressure * (0.2 + relativePos * 16);
                } else if (relativePos < 0.3) {
                    pressure = maxPressure * (1.2 - relativePos * 0.8);
                } else {
                    pressure = maxPressure * 0.6 * Math.exp(-2.5 * (relativePos - 0.3));
                }
                
                // Realistischer Geschwindigkeitsverlauf
                const velocityGrowth = 1 - Math.exp(-3.5 * relativePos);
                const velocity = maxVelocity * velocityGrowth;
                
                // Energieverlauf
                const energy = maxEnergy * Math.pow(velocityGrowth, 2);
                
                // Einfache Flugbahn (0-300m)
                const distance = relativePos * 300; // Meter
                const drop = 0.5 * 9.81 * Math.pow(distance / velocity, 2) * 1000; // mm
                
                chartData.pressure.push({ x: position, y: Math.max(0, pressure) });
                chartData.velocity.push({ x: position, y: velocity });
                chartData.energy.push({ x: position, y: energy });
                chartData.trajectory.push({ x: distance, y: -drop });
            }
        }

        function showChart(type) {
            currentChart = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            drawChart();
        }

        function drawChart() {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!chartData[currentChart]) return;
            
            const data = chartData[currentChart];
            const padding = 70;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Achsen zeichnen
            ctx.strokeStyle = '#2d5016';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Gitter zeichnen
            ctx.strokeStyle = '#d4f4dd';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 10; i++) {
                const x = padding + (i / 10) * chartWidth;
                const y = canvas.height - padding - (i / 10) * chartHeight;
                
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, canvas.height - padding);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Daten normalisieren
            const maxX = Math.max(...data.map(p => p.x));
            const maxY = Math.max(...data.map(p => p.y));
            const minY = Math.min(...data.map(p => p.y));
            const rangeY = maxY - minY;
            
            // Graph zeichnen
            const colors = {
                'pressure': '#dc2626',
                'velocity': '#2563eb', 
                'energy': '#16a34a',
                'trajectory': '#7c2d12'
            };
            
            ctx.strokeStyle = colors[currentChart] || '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = padding + (point.x / maxX) * chartWidth;
                const y = canvas.height - padding - ((point.y - minY) / rangeY) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Beschriftungen
            ctx.fillStyle = '#2d5016';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            
            // Titel
            const titles = {
                'pressure': 'Druckverlauf im Lauf',
                'velocity': 'Geschwindigkeitsverlauf',
                'energy': 'Energieverlauf',
                'trajectory': 'Geschossflugbahn'
            };
            ctx.fillText(titles[currentChart] || '', canvas.width / 2, 30);
            
            // Achsenbeschriftungen
            ctx.font = '12px Arial';
            const xLabels = {
                'pressure': 'Laufposition (mm)',
                'velocity': 'Laufposition (mm)',
                'energy': 'Laufposition (mm)',
                'trajectory': 'Entfernung (m)'
            };
            const yLabels = {
                'pressure': 'Druck (bar)',
                'velocity': 'Geschwindigkeit (m/s)',
                'energy': 'Energie (J)',
                'trajectory': 'Geschossbahn (mm)'
            };
            
            ctx.fillText(xLabels[currentChart] || '', canvas.width / 2, canvas.height - 10);
            
            // Y-Achse
            ctx.save();
            ctx.translate(25, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(yLabels[currentChart] || '', 0, 0);
            ctx.restore();
            
            // Werte an den Achsen
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const y = canvas.height - padding - (i / 5) * chartHeight;
                const value = Math.round(minY + (rangeY * i / 5));
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
            
            ctx.textAlign = 'center';
            for (let i = 0; i <= 5; i++) {
                const x = padding + (i / 5) * chartWidth;
                const value = Math.round((maxX * i / 5));
                ctx.fillText(value.toString(), x, canvas.height - padding + 20);
            }
        }

        // Automatische Aktualisierung der abhängigen Felder
        document.getElementById('cartridge').addEventListener('change', function() {
            const cartridgeData = {
                '308win': { caseLength: 51.18, bulletDiameter: 7.82, grooveCaliberBore: 7.62, grooveCaliberGroove: 7.82 },
                '30-06': { caseLength: 63.35, bulletDiameter: 7.82, grooveCaliberBore: 7.62, grooveCaliberGroove: 7.82 },
                '270win': { caseLength: 64.51, bulletDiameter: 6.86, grooveCaliberBore: 6.78, grooveCaliberGroove: 6.86 },
                '223rem': { caseLength: 44.70, bulletDiameter: 5.69, grooveCaliberBore: 5.56, grooveCaliberGroove: 5.69 }
            };
            
            const selected = this.value;
            if (cartridgeData[selected]) {
                const data = cartridgeData[selected];
                document.getElementById('caseLength').value = data.caseLength;
                document.getElementById('bulletDiameter').value = data.bulletDiameter;
                document.getElementById('grooveCaliberBore').value = data.grooveCaliberBore;
                document.getElementById('grooveCaliberGroove').value = data.grooveCaliberGroove;
            }
        });
    </script>
</body>
</html>
