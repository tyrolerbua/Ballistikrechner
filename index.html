import React, { useState, useEffect, useMemo } from 'react';
import { Calculator, Target, AlertTriangle, Info, Download, Settings, Database, BarChart3, Activity, Thermometer, Wind, Gauge } from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Area, AreaChart } from 'recharts';

// Massive erweiterte Patronendatenbank
const cartridgeData = {
  // .22 Kaliber
  '.22 LR': { capacity: 4.6, maxPressure: 24000, casingWeight: 25, caseLength: 0.613, grooveDiameter: 0.224, landDiameter: 0.219, riflingTwist: 16, cartridgeLength: 1.000, neckDiameter: 0.226, shoulderDiameter: 0.226, baseDiameter: 0.226, rimDiameter: 0.278 },
  '.22-250 Remington': { capacity: 45.5, maxPressure: 65000, casingWeight: 135, caseLength: 1.912, grooveDiameter: 0.224, landDiameter: 0.219, riflingTwist: 14, cartridgeLength: 2.350, neckDiameter: 0.253, shoulderDiameter: 0.414, baseDiameter: 0.470, rimDiameter: 0.473 },
  '.223 Remington': { capacity: 28.5, maxPressure: 55000, casingWeight: 95, caseLength: 1.760, grooveDiameter: 0.224, landDiameter: 0.219, riflingTwist: 9, cartridgeLength: 2.260, neckDiameter: 0.253, shoulderDiameter: 0.354, baseDiameter: 0.378, rimDiameter: 0.378 },
  '.224 Valkyrie': { capacity: 34.2, maxPressure: 55000, casingWeight: 105, caseLength: 1.600, grooveDiameter: 0.224, landDiameter: 0.219, riflingTwist: 7, cartridgeLength: 2.260, neckDiameter: 0.254, shoulderDiameter: 0.445, baseDiameter: 0.473, rimDiameter: 0.473 },

  // 6mm Kaliber  
  '.243 Winchester': { capacity: 53.0, maxPressure: 60000, casingWeight: 160, caseLength: 2.045, grooveDiameter: 0.243, landDiameter: 0.237, riflingTwist: 10, cartridgeLength: 2.710, neckDiameter: 0.276, shoulderDiameter: 0.454, baseDiameter: 0.470, rimDiameter: 0.473 },
  '6mm Creedmoor': { capacity: 53.7, maxPressure: 62000, casingWeight: 165, caseLength: 1.920, grooveDiameter: 0.243, landDiameter: 0.237, riflingTwist: 7.5, cartridgeLength: 2.825, neckDiameter: 0.272, shoulderDiameter: 0.420, baseDiameter: 0.470, rimDiameter: 0.473 },
  '6mm PPC': { capacity: 33.5, maxPressure: 60000, casingWeight: 120, caseLength: 1.515, grooveDiameter: 0.243, landDiameter: 0.237, riflingTwist: 14, cartridgeLength: 2.175, neckDiameter: 0.272, shoulderDiameter: 0.441, baseDiameter: 0.445, rimDiameter: 0.445 },

  // 6.5mm Kaliber
  '6.5 Creedmoor': { capacity: 52.5, maxPressure: 62000, casingWeight: 165, caseLength: 1.920, grooveDiameter: 0.264, landDiameter: 0.256, riflingTwist: 8, cartridgeLength: 2.825, neckDiameter: 0.295, shoulderDiameter: 0.420, baseDiameter: 0.470, rimDiameter: 0.473 },
  '6.5 PRC': { capacity: 68.0, maxPressure: 65000, casingWeight: 190, caseLength: 2.030, grooveDiameter: 0.264, landDiameter: 0.256, riflingTwist: 8, cartridgeLength: 2.955, neckDiameter: 0.295, shoulderDiameter: 0.532, baseDiameter: 0.532, rimDiameter: 0.532 },
  '6.5x55 Swedish': { capacity: 65.8, maxPressure: 51000, casingWeight: 185, caseLength: 2.165, grooveDiameter: 0.264, landDiameter: 0.256, riflingTwist: 8, cartridgeLength: 3.150, neckDiameter: 0.295, shoulderDiameter: 0.445, baseDiameter: 0.480, rimDiameter: 0.480 },
  '6.5 Grendel': { capacity: 35.0, maxPressure: 52000, casingWeight: 125, caseLength: 1.520, grooveDiameter: 0.264, landDiameter: 0.256, riflingTwist: 8, cartridgeLength: 2.260, neckDiameter: 0.295, shoulderDiameter: 0.431, baseDiameter: 0.441, rimDiameter: 0.441 },

  // .270 Kaliber
  '.270 Winchester': { capacity: 67.0, maxPressure: 65000, casingWeight: 185, caseLength: 2.540, grooveDiameter: 0.277, landDiameter: 0.270, riflingTwist: 10, cartridgeLength: 3.340, neckDiameter: 0.308, shoulderDiameter: 0.441, baseDiameter: 0.470, rimDiameter: 0.473 },
  '.270 WSM': { capacity: 80.0, maxPressure: 65000, casingWeight: 210, caseLength: 2.100, grooveDiameter: 0.277, landDiameter: 0.270, riflingTwist: 10, cartridgeLength: 2.860, neckDiameter: 0.308, shoulderDiameter: 0.538, baseDiameter: 0.555, rimDiameter: 0.535 },
  '.280 Remington': { capacity: 65.5, maxPressure: 60000, casingWeight: 180, caseLength: 2.540, grooveDiameter: 0.284, landDiameter: 0.277, riflingTwist: 9.5, cartridgeLength: 3.330, neckDiameter: 0.315, shoulderDiameter: 0.441, baseDiameter: 0.470, rimDiameter: 0.473 },
  '.280 AI': { capacity: 71.0, maxPressure: 60000, casingWeight: 185, caseLength: 2.540, grooveDiameter: 0.284, landDiameter: 0.277, riflingTwist: 9.5, cartridgeLength: 3.330, neckDiameter: 0.315, shoulderDiameter: 0.473, baseDiameter: 0.470, rimDiameter: 0.473 },

  // 7mm Kaliber
  '7mm-08 Remington': { capacity: 52.0, maxPressure: 61000, casingWeight: 160, caseLength: 2.035, grooveDiameter: 0.284, landDiameter: 0.277, riflingTwist: 9.5, cartridgeLength: 2.800, neckDiameter: 0.315, shoulderDiameter: 0.454, baseDiameter: 0.470, rimDiameter: 0.473 },
  '7mm Rem Mag': { capacity: 82.0, maxPressure: 61000, casingWeight: 220, caseLength: 2.500, grooveDiameter: 0.284, landDiameter: 0.277, riflingTwist: 9.5, cartridgeLength: 3.290, neckDiameter: 0.315, shoulderDiameter: 0.491, baseDiameter: 0.532, rimDiameter: 0.532 },
  '7mm WSM': { capacity: 78.5, maxPressure: 65000, casingWeight: 200, caseLength: 2.100, grooveDiameter: 0.284, landDiameter: 0.277, riflingTwist: 9.5, cartridgeLength: 2.860, neckDiameter: 0.315, shoulderDiameter: 0.538, baseDiameter: 0.555, rimDiameter: 0.535 },

  // .30 Kaliber
  '.30-30 Winchester': { capacity: 42.0, maxPressure: 42000, casingWeight: 140, caseLength: 2.039, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 12, cartridgeLength: 2.550, neckDiameter: 0.330, shoulderDiameter: 0.401, baseDiameter: 0.422, rimDiameter: 0.506 },
  '.300 AAC Blackout': { capacity: 27.5, maxPressure: 55000, casingWeight: 95, caseLength: 1.368, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 8, cartridgeLength: 2.260, neckDiameter: 0.334, shoulderDiameter: 0.377, baseDiameter: 0.378, rimDiameter: 0.378 },
  '.308 Winchester': { capacity: 56.0, maxPressure: 62000, casingWeight: 175, caseLength: 2.015, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 12, cartridgeLength: 2.800, neckDiameter: 0.334, shoulderDiameter: 0.454, baseDiameter: 0.470, rimDiameter: 0.473 },
  '.30-06 Springfield': { capacity: 68.0, maxPressure: 60000, casingWeight: 190, caseLength: 2.494, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 10, cartridgeLength: 3.340, neckDiameter: 0.340, shoulderDiameter: 0.441, baseDiameter: 0.470, rimDiameter: 0.473 },
  '.300 Win Mag': { capacity: 93.8, maxPressure: 64000, casingWeight: 230, caseLength: 2.620, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 10, cartridgeLength: 3.340, neckDiameter: 0.339, shoulderDiameter: 0.513, baseDiameter: 0.532, rimDiameter: 0.532 },
  '.300 WSM': { capacity: 80.0, maxPressure: 65000, casingWeight: 210, caseLength: 2.100, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 10, cartridgeLength: 2.860, neckDiameter: 0.339, shoulderDiameter: 0.538, baseDiameter: 0.555, rimDiameter: 0.535 },
  '.300 PRC': { capacity: 77.0, maxPressure: 65000, casingWeight: 200, caseLength: 2.580, grooveDiameter: 0.308, landDiameter: 0.300, riflingTwist: 10, cartridgeLength: 3.700, neckDiameter: 0.339, shoulderDiameter: 0.532, baseDiameter: 0.532, rimDiameter: 0.532 },

  // .338 Kaliber
  '.338 Lapua Magnum': { capacity: 114.0, maxPressure: 60916, casingWeight: 280, caseLength: 2.724, grooveDiameter: 0.338, landDiameter: 0.330, riflingTwist: 10, cartridgeLength: 3.681, neckDiameter: 0.370, shoulderDiameter: 0.587, baseDiameter: 0.587, rimDiameter: 0.588 },
  '.338 Win Mag': { capacity: 86.0, maxPressure: 64000, casingWeight: 230, caseLength: 2.500, grooveDiameter: 0.338, landDiameter: 0.330, riflingTwist: 10, cartridgeLength: 3.340, neckDiameter: 0.369, shoulderDiameter: 0.491, baseDiameter: 0.532, rimDiameter: 0.532 },

  // .50 Kaliber
  '.50 BMG': { capacity: 290.0, maxPressure: 55000, casingWeight: 865, caseLength: 3.910, grooveDiameter: 0.510, landDiameter: 0.500, riflingTwist: 15, cartridgeLength: 5.450, neckDiameter: 0.541, shoulderDiameter: 0.804, baseDiameter: 0.804, rimDiameter: 0.804 },

  // Pistolkaliber
  '9mm Luger': { capacity: 13.3, maxPressure: 35000, casingWeight: 60, caseLength: 0.754, grooveDiameter: 0.355, landDiameter: 0.346, riflingTwist: 10, cartridgeLength: 1.169, neckDiameter: 0.380, shoulderDiameter: 0.380, baseDiameter: 0.391, rimDiameter: 0.392 },
  '.40 S&W': { capacity: 16.7, maxPressure: 35000, casingWeight: 75, caseLength: 0.850, grooveDiameter: 0.400, landDiameter: 0.390, riflingTwist: 16, cartridgeLength: 1.135, neckDiameter: 0.424, shoulderDiameter: 0.424, baseDiameter: 0.424, rimDiameter: 0.424 },
  '.45 ACP': { capacity: 23.7, maxPressure: 21000, casingWeight: 95, caseLength: 0.898, grooveDiameter: 0.452, landDiameter: 0.442, riflingTwist: 16, cartridgeLength: 1.275, neckDiameter: 0.476, shoulderDiameter: 0.476, baseDiameter: 0.476, rimDiameter: 0.480 },
  '.357 Magnum': { capacity: 26.2, maxPressure: 35000, casingWeight: 110, caseLength: 1.290, grooveDiameter: 0.357, landDiameter: 0.346, riflingTwist: 14, cartridgeLength: 1.590, neckDiameter: 0.379, shoulderDiameter: 0.379, baseDiameter: 0.379, rimDiameter: 0.440 },
  '.44 Magnum': { capacity: 37.9, maxPressure: 36000, casingWeight: 180, caseLength: 1.285, grooveDiameter: 0.429, landDiameter: 0.420, riflingTwist: 20, cartridgeLength: 1.610, neckDiameter: 0.456, shoulderDiameter: 0.456, baseDiameter: 0.456, rimDiameter: 0.514 }
};

// Erweiterte Pulverdatenbank
const powderData = {
  'Varget': { 
    burnRate: 0.65, density: 0.92, tempCoeff: 0.3, energyDensity: 3850,
    specificHeatRatio: 1.231, heatOfExplosion: 3935, burningRateFactor: 0.388,
    progressiveBurningLimit: 1.595, solidDensity: 1.61, shotStartPressure: 250.0,
    covolume: 1.0, formFunction: 0.85
  },
  'H4350': { 
    burnRate: 0.45, density: 0.89, tempCoeff: 0.2, energyDensity: 3900,
    specificHeatRatio: 1.225, heatOfExplosion: 3950, burningRateFactor: 0.365,
    progressiveBurningLimit: 1.480, solidDensity: 1.58, shotStartPressure: 220.0,
    covolume: 1.05, formFunction: 0.88
  },
  'IMR 4064': { 
    burnRate: 0.72, density: 0.94, tempCoeff: 0.8, energyDensity: 3820,
    specificHeatRatio: 1.240, heatOfExplosion: 3890, burningRateFactor: 0.420,
    progressiveBurningLimit: 1.650, solidDensity: 1.65, shotStartPressure: 280.0,
    covolume: 0.98, formFunction: 0.82
  },
  'H1000': { 
    burnRate: 0.25, density: 0.87, tempCoeff: 0.1, energyDensity: 3950,
    specificHeatRatio: 1.218, heatOfExplosion: 4020, burningRateFactor: 0.285,
    progressiveBurningLimit: 1.320, solidDensity: 1.52, shotStartPressure: 180.0,
    covolume: 1.12, formFunction: 0.92
  },
  'RL22': { 
    burnRate: 0.35, density: 0.91, tempCoeff: 0.6, energyDensity: 3880,
    specificHeatRatio: 1.235, heatOfExplosion: 3920, burningRateFactor: 0.345,
    progressiveBurningLimit: 1.420, solidDensity: 1.59, shotStartPressure: 200.0,
    covolume: 1.08, formFunction: 0.90
  },
  'N560': { 
    burnRate: 0.38, density: 0.98, tempCoeff: 0.15, energyDensity: 3920,
    specificHeatRatio: 1.228, heatOfExplosion: 3980, burningRateFactor: 0.355,
    progressiveBurningLimit: 1.380, solidDensity: 1.62, shotStartPressure: 190.0,
    covolume: 1.03, formFunction: 0.89
  }
};

// Erweiterte Geschossdatenbank
const bulletData = {
  '168gr HPBT': { 
    weight: 168, diameter: 0.308, bc: 0.462, length: 1.210, 
    shankLength: 0.650, ogiveLength: 0.560, boattailLength: 0.180,
    crossSectionalArea: 0.0745, dragCoefficient: 0.295, formFactor: 1.02
  },
  '175gr HPBT': { 
    weight: 175, diameter: 0.308, bc: 0.496, length: 1.240,
    shankLength: 0.680, ogiveLength: 0.580, boattailLength: 0.180,
    crossSectionalArea: 0.0745, dragCoefficient: 0.285, formFactor: 0.98
  },
  '150gr SPBT': { 
    weight: 150, diameter: 0.308, bc: 0.415, length: 1.150,
    shankLength: 0.620, ogiveLength: 0.530, boattailLength: 0.160,
    crossSectionalArea: 0.0745, dragCoefficient: 0.315, formFactor: 1.08
  },
  '77gr TMK': { 
    weight: 77, diameter: 0.224, bc: 0.372, length: 1.030,
    shankLength: 0.580, ogiveLength: 0.450, boattailLength: 0.140,
    crossSectionalArea: 0.0394, dragCoefficient: 0.298, formFactor: 1.05
  },
  '140gr ELD-M': { 
    weight: 140, diameter: 0.264, bc: 0.646, length: 1.345,
    shankLength: 0.720, ogiveLength: 0.625, boattailLength: 0.200,
    crossSectionalArea: 0.0547, dragCoefficient: 0.268, formFactor: 0.92
  }
};

const AdvancedBallisticsCalculator = () => {
  // Erweiterte State-Variablen
  const [activeTab, setActiveTab] = useState('config');
  const [cartridge, setCartridge] = useState('.308 Winchester');
  const [powder, setPowder] = useState('Varget');
  const [bullet, setBullet] = useState('168gr HPBT');
  const [charge, setCharge] = useState(42.0);
  
  // Detaillierte Parameter
  const [barrelLength, setBarrelLength] = useState(24);
  const [seatingDepth, setSeatingDepth] = useState(0.020);
  const [temperature, setTemperature] = useState(20);
  const [pressure, setPressure] = useState(1013.25);
  const [humidity, setHumidity] = useState(50);
  const [windSpeed, setWindSpeed] = useState(0);
  const [windDirection, setWindDirection] = useState(90);
  
  // Erweiterte Geschossparameter
  const [customBulletWeight, setCustomBulletWeight] = useState(0);
  const [customBulletDiameter, setCustomBulletDiameter] = useState(0);
  const [customBC, setCustomBC] = useState(0);
  const [cartridgeLength, setCartridgeLength] = useState(0);
  const [caseLength, setCaseLength] = useState(0);
  const [grooveDiameter, setGrooveDiameter] = useState(0);
  
  // Erweiterte Pulverparameter
  const [customChargeWeight, setCustomChargeWeight] = useState(0);
  const [loadDensityTarget, setLoadDensityTarget] = useState(95);
  const [ignitionPressure, setIgnitionPressure] = useState(250);
  
  const [results, setResults] = useState({});
  const [chartData, setChartData] = useState([]);
  const [pressureChart, setPressureChart] = useState([]);

  // Erweiterte ballistische Berechnungen
  const calculateAdvancedBallistics = useMemo(() => {
    const cartData = cartridgeData[cartridge];
    const powderInfo = powderData[powder];
    const bulletInfo = bulletData[bullet];
    
    if (!cartData || !powderInfo || !bulletInfo) return {};

    // Effektive Parameter berechnen
    const effectiveBulletWeight = customBulletWeight || bulletInfo.weight;
    const effectiveBulletDiameter = customBulletDiameter || bulletInfo.diameter;
    const effectiveBC = customBC || bulletInfo.bc;
    const effectiveCartridgeLength = cartridgeLength || cartData.cartridgeLength;
    const effectiveCaseLength = caseLength || cartData.caseLength;
    const effectiveGrooveDiameter = grooveDiameter || cartData.grooveDiameter;
    
    // Volumenberechnungen
    const bulletVolume = (Math.PI * Math.pow(effectiveBulletDiameter/2, 2) * bulletInfo.length) / 4;
    const seatingVolumeReduction = seatingDepth * Math.PI * Math.pow(effectiveBulletDiameter/2, 2);
    const effectiveCaseCapacity = cartData.capacity - seatingVolumeReduction;
    const volumeBehindBullet = effectiveCaseCapacity - bulletVolume;
    
    // Erweiterte Druckberechnung (Noble-Abel-Gleichung)
    const chargeVolume = charge / powderInfo.density;
    const loadDensity = (chargeVolume / effectiveCaseCapacity) * 100;
    const freeVolume = volumeBehindBullet - chargeVolume;
    
    // Temperaturkorrekturen
    const tempKelvin = temperature + 273.15;
    const standardTemp = 293.15;
    const tempRatio = tempKelvin / standardTemp;
    const pressureAltitude = pressure / 1013.25;
    
    // Erweiterte Druckberechnung
    const gasConstant = 8314; // J/(kmol·K)
    const molarMass = 28.97; // kg/kmol für Verbrennungsgase
    const combustionTemp = tempKelvin + 2800; // Verbrennungstemperatur
    
    const forceConstant = (charge * powderInfo.energyDensity * powderInfo.burningRateFactor) / 1000;
    const covolumeFactor = 1 - (powderInfo.covolume * charge / volumeBehindBullet);
    const basePressure = (forceConstant * combustionTemp * powderInfo.formFunction) / 
                        (freeVolume * covolumeFactor);
    
    // Druckmodifikationen
    const densityModifier = 1 + ((loadDensity - 85) * 0.004);
    const tempModifier = Math.pow(tempRatio, 0.7);
    const altitudeModifier = pressureAltitude;
    
    const maxPressure = basePressure * densityModifier * tempModifier * altitudeModifier;
    
    // Erweiterte Geschwindigkeitsberechnung
    const barrelVolume = Math.PI * Math.pow(effectiveGrooveDiameter/2, 2) * barrelLength;
    const expansionRatio = (volumeBehindBullet + barrelVolume) / volumeBehindBullet;
    const adiabaticIndex = powderInfo.specificHeatRatio;
    
    // Geschwindigkeit nach adiabatischer Expansion
    const adiabaticPressureRatio = Math.pow(expansionRatio, -adiabaticIndex);
    const muzzlePressure = maxPressure * adiabaticPressureRatio;
    
    const specificEnergy = powderInfo.energyDensity * charge / effectiveBulletWeight;
    const efficiency = Math.min(1.0, powderInfo.burnRate * (barrelLength / 24) * powderInfo.formFunction);
    const baseVelocity = Math.sqrt(2 * specificEnergy * efficiency * 0.7) * tempModifier;
    
    // Laufzeitberechnungen
    const accelerationTime = Math.sqrt((2 * barrelLength * 0.0254 * effectiveBulletWeight * 0.001) / 
                                      (maxPressure * Math.PI * Math.pow(effectiveGrooveDiameter * 0.0254/2, 2))) * 1000;
    
    // Mündungsenergie und Rückstoß
    const muzzleEnergy = (baseVelocity * baseVelocity * effectiveBulletWeight) / 450240;
    const recoilVelocity = ((effectiveBulletWeight * baseVelocity) + (charge * 4000)) / (7000 * 8); // 8 lbs Gewehr
    const recoilEnergy = (Math.pow(recoilVelocity, 2) * 8) / 64.32;
    
    // Ballistische Effizienz
    const theoreticalEnergy = charge * powderInfo.energyDensity / 7000; // ft-lbs
    const ballisticEfficiency = (muzzleEnergy / theoreticalEnergy) * 100;
    
    // Optimaler Barrel Time (OBT)
    const fundamentalFrequency = barrelLength / 2;
    const optimalBarrelTime = (1000 / fundamentalFrequency) * 1.5;
    
    // Projektil-Energie bei verschiedenen Entfernungen
    const projectileEnergy100 = muzzleEnergy * Math.pow(Math.E, -0.1 * 100 / effectiveBC);
    const projectileEnergy300 = muzzleEnergy * Math.pow(Math.E, -0.1 * 300 / effectiveBC);
    
    // Sicherheitsbewertung
    const pressureRatio = maxPressure / cartData.maxPressure;
    let safetyRating = 'SICHER';
    let safetyColor = 'green';
    
    if (pressureRatio > 1.05) {
      safetyRating = 'GEFÄHRLICH';
      safetyColor = 'red';
    } else if (pressureRatio > 1.0) {
      safetyRating = 'ÜBERDRUCK';
      safetyColor = 'orange';
    } else if (pressureRatio > 0.95) {
      safetyRating = 'HOCH';
      safetyColor = 'yellow';
    } else if (pressureRatio > 0.9) {
      safetyRating = 'MODERAT';
      safetyColor = 'blue';
    }

    return {
      maxPressure,
      muzzlePressure,
      muzzleVelocity: baseVelocity,
      muzzleEnergy,
      recoilEnergy,
      barrelTime: accelerationTime,
      optimalBarrelTime,
      loadDensity,
      ballisticEfficiency,
      projectileEnergy100,
      projectileEnergy300,
      pressureRatio,
      safetyRating,
      safetyColor,
      effectiveCaseCapacity,
      volumeBehindBullet,
      expansionRatio,
      combustionTemp,
      freeVolume
    };
  }, [cartridge, powder, bullet, charge, barrelLength, seatingDepth, temperature, pressure, humidity,
      customBulletWeight, customBulletDiameter, customBC, cartridgeLength, caseLength, grooveDiameter]);

  // Diagrammdaten generieren
  useEffect(() => {
    if (!calculateAdvancedBallistics.maxPressure) return;
    
    // Geschwindigkeits-Zeit-Kurve
    const velocityData = [];
    const pressureData = [];
    const maxTime = calculateAdvancedBallistics.barrelTime;
    
    for (let i = 0; i <= 50; i++) {
      const time = (i / 50) * maxTime;
      const timeRatio = time / maxTime;
      
      // Geschwindigkeitskurve (progressiv)
      const velocity = calculateAdvancedBallistics.muzzleVelocity * Math.sqrt(timeRatio);
      
      // Druckkurve (Peak bei ~30% der Laufzeit)
      const pressureCurveRatio = timeRatio < 0.3 ? 
        Math.sin(timeRatio * Math.PI / 0.6) : 
        Math.exp(-(timeRatio - 0.3) * 5) * Math.sin(0.5 * Math.PI);
      const pressure = calculateAdvancedBallistics.maxPressure * pressureCurveRatio;
      
      velocityData.push({
        time: time,
        velocity: velocity,
        distance: (velocity * time) / 2000 // Vereinfachte Distanz
      });
      
      pressureData.push({
        time: time,
        pressure: pressure / 1000, // in kPSI
        temperature: 2800 + (temperature - 20) * pressureCurveRatio
      });
    }
    
    setChartData(velocityData);
    setPressureChart(pressureData);
  }, [calculateAdvancedBallistics]);

  const TabButton = ({ id, label, icon: Icon, active, onClick }) => (
    <button
      onClick={() => onClick(id)}
      className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
        active 
          ? 'bg-blue-600 text-white shadow-lg' 
          : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
      }`}
    >
      <Icon className="w-4 h-4" />
      <span>{label}</span>
    </button>
  );

  const InputField = ({ label, value, onChange, min, max, step = 0.1, unit = "", type = "number" }) => (
    <div className="space-y-2">
      <label className="block text-sm font-medium text-blue-200">
        {label} {unit && `(${unit})`}
      </label>
      <input
        type={type}
        value={value}
        onChange={(e) => onChange(type === "number" ? parseFloat(e.target.value) || 0 : e.target.value)}
        min={min}
        max={max}
        step={step}
        className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none"
      />
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {/* Header */}
      <div className="bg-black/20 backdrop-blur-sm border-b border-blue-500/30">
        <div className="max-w-full mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <Target className="w-8 h-8 text-blue-400" />
              <div>
                <h1 className="text-2xl font-bold text-white">QuickLOAD Professional</h1>
                <p className="text-blue-300 text-sm">Erweiterte ballistische Berechnungsplattform</p>
              </div>
            </div>
            <div className="flex items-center space-x-4">
              {calculateAdvancedBallistics.safetyRating && (
                <div className={`px-4 py-2 rounded-lg font-bold text-${calculateAdvancedBallistics.safetyColor}-400 bg-${calculateAdvancedBallistics.safetyColor}-900/30 border border-${calculateAdvancedBallistics.safetyColor}-500/50`}>
                  {calculateAdvancedBallistics.safetyRating}
                </div>
              )}
              <button className="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                <Download className="w-4 h-4" />
                <span>Export</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* Navigation Tabs */}
      <div className="bg-black/10 backdrop-blur-sm border-b border-slate-700">
        <div className="max-w-full mx-auto px-6 py-4">
          <div className="flex space-x-2 overflow-x-auto">
            <TabButton id="config" label="Konfiguration" icon={Settings} active={activeTab === 'config'} onClick={setActiveTab} />
            <TabButton id="detailed" label="Detaillierte Parameter" icon={Database} active={activeTab === 'detailed'} onClick={setActiveTab} />
            <TabButton id="results" label="Ergebnisse" icon={Calculator} active={activeTab === 'results'} onClick={setActiveTab} />
            <TabButton id="charts" label="Diagramme" icon={BarChart3} active={activeTab === 'charts'} onClick={setActiveTab} />
            <TabButton id="environment" label="Umgebung" icon={Thermometer} active={activeTab === 'environment'} onClick={setActiveTab} />
          </div>
        </div>
      </div>

      <div className="max-w-full mx-auto px-6 py-8">
        {/* Konfiguration Tab */}
        {activeTab === 'config' && (
          <div className="grid lg:grid-cols-3 gap-8">
            {/* Grundkonfiguration */}
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6 flex items-center">
                <Settings className="w-5 h-5 mr-2 text-blue-400" />
                Grundkonfiguration
              </h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-blue-200 mb-2">Patrone</label>
                  <select 
                    value={cartridge} 
                    onChange={(e) => setCartridge(e.target.value)}
                    className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none"
                  >
                    {Object.keys(cartridgeData).map(cart => (
                      <option key={cart} value={cart}>{cart}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-blue-200 mb-2">Pulver</label>
                  <select 
                    value={powder} 
                    onChange={(e) => setPowder(e.target.value)}
                    className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none"
                  >
                    {Object.keys(powderData).map(pow => (
                      <option key={pow} value={pow}>{pow}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-blue-200 mb-2">Geschoss</label>
                  <select 
                    value={bullet} 
                    onChange={(e) => setBullet(e.target.value)}
                    className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:border-blue-500 focus:outline-none"
                  >
                    {Object.keys(bulletData).map(bul => (
                      <option key={bul} value={bul}>{bul}</option>
                    ))}
                  </select>
                </div>

                <InputField 
                  label="Ladung" 
                  value={charge} 
                  onChange={setCharge} 
                  min={20} 
                  max={60} 
                  step={0.1} 
                  unit="gr" 
                />

                <InputField 
                  label="Lauflänge" 
                  value={barrelLength} 
                  onChange={setBarrelLength} 
                  min={16} 
                  max={32} 
                  step={0.5} 
                  unit="Zoll" 
                />

                <InputField 
                  label="Setztiefe" 
                  value={seatingDepth} 
                  onChange={setSeatingDepth} 
                  min={0.005} 
                  max={0.200} 
                  step={0.005} 
                  unit="Zoll" 
                />
              </div>
            </div>

            {/* Pulverdetails */}
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Pulvercharakteristika</h2>
              
              {powderData[powder] && (
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-blue-200">Brennrate:</span>
                    <span className="text-white font-mono">{powderData[powder].burningRateFactor}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Dichte:</span>
                    <span className="text-white font-mono">{powderData[powder].density} g/cm³</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Temp. Koeffizient:</span>
                    <span className="text-white font-mono">{powderData[powder].tempCoeff} fps/°F</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Energiedichte:</span>
                    <span className="text-white font-mono">{powderData[powder].energyDensity} J/g</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Explosion Heat:</span>
                    <span className="text-white font-mono">{powderData[powder].heatOfExplosion} kJ/kg</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Spez. Wärmeverhältnis:</span>
                    <span className="text-white font-mono">{powderData[powder].specificHeatRatio}</span>
                  </div>
                </div>
              )}
            </div>

            {/* Geschossdetails */}
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Geschossparameter</h2>
              
              {bulletData[bullet] && (
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-blue-200">Gewicht:</span>
                    <span className="text-white font-mono">{bulletData[bullet].weight} gr</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Durchmesser:</span>
                    <span className="text-white font-mono">{bulletData[bullet].diameter}"</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Ballistischer Koeff.:</span>
                    <span className="text-white font-mono">{bulletData[bullet].bc}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Länge:</span>
                    <span className="text-white font-mono">{bulletData[bullet].length}"</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Schaftlänge:</span>
                    <span className="text-white font-mono">{bulletData[bullet].shankLength}"</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Querschnittsfläche:</span>
                    <span className="text-white font-mono">{bulletData[bullet].crossSectionalArea} in²</span>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {/* Detaillierte Parameter Tab */}
        {activeTab === 'detailed' && (
          <div className="grid lg:grid-cols-3 gap-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Benutzerdefinierte Geschossparameter</h2>
              <div className="space-y-4">
                <InputField label="Geschossgewicht" value={customBulletWeight} onChange={setCustomBulletWeight} min={50} max={250} unit="gr" />
                <InputField label="Geschossdurchmesser" value={customBulletDiameter} onChange={setCustomBulletDiameter} min={0.2} max={0.4} step={0.001} unit="Zoll" />
                <InputField label="Ballistischer Koeffizient" value={customBC} onChange={setCustomBC} min={0.2} max={0.8} step={0.001} />
                <InputField label="Patronenlänge" value={cartridgeLength} onChange={setCartridgeLength} min={1.5} max={4.0} step={0.001} unit="Zoll" />
                <InputField label="Hülsenlänge" value={caseLength} onChange={setCaseLength} min={1.0} max={3.0} step={0.001} unit="Zoll" />
                <InputField label="Zugdurchmesser" value={grooveDiameter} onChange={setGrooveDiameter} min={0.2} max={0.4} step={0.001} unit="Zoll" />
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Erweiterte Pulverparameter</h2>
              <div className="space-y-4">
                <InputField label="Ladungsgewicht" value={customChargeWeight} onChange={setCustomChargeWeight} min={20} max={80} step={0.1} unit="gr" />
                <InputField label="Ziel-Ladungsdichte" value={loadDensityTarget} onChange={setLoadDensityTarget} min={70} max={110} step={1} unit="%" />
                <InputField label="Zünddruck" value={ignitionPressure} onChange={setIgnitionPressure} min={100} max={500} step={10} unit="bar" />
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Berechnete Volumina</h2>
              {calculateAdvancedBallistics.effectiveCaseCapacity && (
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-blue-200">Eff. Hülsenkapazität:</span>
                    <span className="text-white font-mono">{calculateAdvancedBallistics.effectiveCaseCapacity?.toFixed(2)} gr H₂O</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Volumen hinter Geschoss:</span>
                    <span className="text-white font-mono">{calculateAdvancedBallistics.volumeBehindBullet?.toFixed(2)} gr H₂O</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Freies Volumen:</span>
                    <span className="text-white font-mono">{calculateAdvancedBallistics.freeVolume?.toFixed(2)} gr H₂O</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-blue-200">Expansionsverhältnis:</span>
                    <span className="text-white font-mono">{calculateAdvancedBallistics.expansionRatio?.toFixed(2)}:1</span>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {/* Ergebnisse Tab */}
        {activeTab === 'results' && (
          <div className="grid lg:grid-cols-2 gap-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6 flex items-center">
                <Gauge className="w-5 h-5 mr-2 text-blue-400" />
                Interne Ballistik
              </h2>
              
              <div className="space-y-4">
                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Maximaler Druck:</span>
                    <span className={`font-mono text-lg text-${calculateAdvancedBallistics.safetyColor}-400`}>
                      {calculateAdvancedBallistics.maxPressure?.toFixed(0)} PSI
                    </span>
                  </div>
                  <div className="text-xs text-gray-400 mt-1">
                    {((calculateAdvancedBallistics.pressureRatio || 0) * 100).toFixed(1)}% von SAAMI Maximum
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Mündungsdruck:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.muzzlePressure?.toFixed(0)} PSI
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Mündungsgeschwindigkeit:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.muzzleVelocity?.toFixed(0)} fps
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Laufzeit (10%):</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.barrelTime?.toFixed(2)} ms
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Optimaler OBT:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.optimalBarrelTime?.toFixed(2)} ms
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Ladungsdichte:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.loadDensity?.toFixed(1)}%
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6 flex items-center">
                <Activity className="w-5 h-5 mr-2 text-blue-400" />
                Externe Ballistik
              </h2>
              
              <div className="space-y-4">
                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Mündungsenergie:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.muzzleEnergy?.toFixed(0)} ft-lbs
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Rückstoßenergie:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.recoilEnergy?.toFixed(1)} ft-lbs
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Projektilenergie @ 100y:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.projectileEnergy100?.toFixed(0)} ft-lbs
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Projektilenergie @ 300y:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.projectileEnergy300?.toFixed(0)} ft-lbs
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Ballistische Effizienz:</span>
                    <span className="text-white font-mono text-lg">
                      {calculateAdvancedBallistics.ballisticEfficiency?.toFixed(1)}%
                    </span>
                  </div>
                </div>

                <div className="p-4 bg-slate-800/50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="text-blue-200">Verbrannte Pulvermenge:</span>
                    <span className="text-white font-mono text-lg">100.0%</span>
                  </div>
                </div>
              </div>

              {/* Druckvisualisierung */}
              <div className="mt-6 p-4 bg-slate-800/50 rounded-lg">
                <h3 className="text-lg font-semibold text-white mb-3">Druckanalyse</h3>
                <div className="relative h-6 bg-gray-700 rounded-full overflow-hidden">
                  <div 
                    className={`h-full transition-all duration-500 ${
                      calculateAdvancedBallistics.safetyColor === 'red' ? 'bg-red-500' :
                      calculateAdvancedBallistics.safetyColor === 'orange' ? 'bg-orange-500' :
                      calculateAdvancedBallistics.safetyColor === 'yellow' ? 'bg-yellow-500' :
                      calculateAdvancedBallistics.safetyColor === 'blue' ? 'bg-blue-500' : 'bg-green-500'
                    }`}
                    style={{ width: `${Math.min((calculateAdvancedBallistics.pressureRatio || 0) * 100, 100)}%` }}
                  />
                  <div className="absolute inset-0 flex items-center justify-center text-sm font-semibold text-white">
                    {((calculateAdvancedBallistics.pressureRatio || 0) * 100).toFixed(1)}% SAAMI Max
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Diagramme Tab */}
        {activeTab === 'charts' && (
          <div className="grid lg:grid-cols-2 gap-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Geschwindigkeit vs. Zeit</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis 
                      dataKey="time" 
                      stroke="#94a3b8"
                      label={{ value: 'Zeit (ms)', position: 'insideBottom', offset: -5, fill: '#94a3b8' }}
                    />
                    <YAxis 
                      stroke="#94a3b8"
                      label={{ value: 'Geschwindigkeit (fps)', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                    />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1e293b', 
                        border: '1px solid #475569',
                        borderRadius: '8px',
                        color: '#f1f5f9'
                      }}
                    />
                    <Line 
                      type="monotone" 
                      dataKey="velocity" 
                      stroke="#3b82f6" 
                      strokeWidth={3}
                      dot={false}
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Druck vs. Zeit</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={pressureChart}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis 
                      dataKey="time" 
                      stroke="#94a3b8"
                      label={{ value: 'Zeit (ms)', position: 'insideBottom', offset: -5, fill: '#94a3b8' }}
                    />
                    <YAxis 
                      stroke="#94a3b8"
                      label={{ value: 'Druck (kPSI)', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                    />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1e293b', 
                        border: '1px solid #475569',
                        borderRadius: '8px',
                        color: '#f1f5f9'
                      }}
                    />
                    <Area 
                      type="monotone" 
                      dataKey="pressure" 
                      stroke="#ef4444" 
                      fill="url(#pressureGradient)"
                      strokeWidth={2}
                    />
                    <defs>
                      <linearGradient id="pressureGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#ef4444" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#ef4444" stopOpacity={0.1}/>
                      </linearGradient>
                    </defs>
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Geschossweg vs. Zeit</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis 
                      dataKey="time" 
                      stroke="#94a3b8"
                      label={{ value: 'Zeit (ms)', position: 'insideBottom', offset: -5, fill: '#94a3b8' }}
                    />
                    <YAxis 
                      stroke="#94a3b8"
                      label={{ value: 'Distanz (Zoll)', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                    />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1e293b', 
                        border: '1px solid #475569',
                        borderRadius: '8px',
                        color: '#f1f5f9'
                      }}
                    />
                    <Line 
                      type="monotone" 
                      dataKey="distance" 
                      stroke="#10b981" 
                      strokeWidth={3}
                      dot={false}
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6">Temperatur vs. Zeit</h2>
              <div className="h-80">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={pressureChart}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                    <XAxis 
                      dataKey="time" 
                      stroke="#94a3b8"
                      label={{ value: 'Zeit (ms)', position: 'insideBottom', offset: -5, fill: '#94a3b8' }}
                    />
                    <YAxis 
                      stroke="#94a3b8"
                      label={{ value: 'Temperatur (K)', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                    />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1e293b', 
                        border: '1px solid #475569',
                        borderRadius: '8px',
                        color: '#f1f5f9'
                      }}
                    />
                    <Area 
                      type="monotone" 
                      dataKey="temperature" 
                      stroke="#f59e0b" 
                      fill="url(#tempGradient)"
                      strokeWidth={2}
                    />
                    <defs>
                      <linearGradient id="tempGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#f59e0b" stopOpacity={0.8}/>
                        <stop offset="95%" stopColor="#f59e0b" stopOpacity={0.1}/>
                      </linearGradient>
                    </defs>
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>
        )}

        {/* Umgebung Tab */}
        {activeTab === 'environment' && (
          <div className="grid lg:grid-cols-2 gap-8">
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6 flex items-center">
                <Thermometer className="w-5 h-5 mr-2 text-blue-400" />
                Atmosphärische Bedingungen
              </h2>
              
              <div className="space-y-4">
                <InputField 
                  label="Temperatur" 
                  value={temperature} 
                  onChange={setTemperature} 
                  min={-30} 
                  max={50} 
                  unit="°C" 
                />
                <InputField 
                  label="Luftdruck" 
                  value={pressure} 
                  onChange={setPressure} 
                  min={800} 
                  max={1100} 
                  step={0.1} 
                  unit="hPa" 
                />
                <InputField 
                  label="Luftfeuchtigkeit" 
                  value={humidity} 
                  onChange={setHumidity} 
                  min={0} 
                  max={100} 
                  unit="%" 
                />
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
              <h2 className="text-xl font-semibold text-white mb-6 flex items-center">
                <Wind className="w-5 h-5 mr-2 text-blue-400" />
                Windbedingungen
              </h2>
              
              <div className="space-y-4">
                <InputField 
                  label="Windgeschwindigkeit" 
                  value={windSpeed} 
                  onChange={setWindSpeed} 
                  min={0} 
                  max={50} 
                  unit="km/h" 
                />
                <InputField 
                  label="Windrichtung" 
                  value={windDirection} 
                  onChange={setWindDirection} 
                  min={0} 
                  max={360} 
                  unit="°" 
                />
              </div>
            </div>
          </div>
        )}

        {/* Sicherheitshinweis */}
        <div className="mt-8 p-6 bg-yellow-900/30 border border-yellow-500/50 rounded-lg">
          <div className="flex items-start space-x-3">
            <AlertTriangle className="w-6 h-6 text-yellow-400 mt-1 flex-shrink-0" />
            <div className="text-yellow-200">
              <h3 className="font-semibold mb-2">Wichtiger Sicherheitshinweis</h3>
              <p className="text-sm leading-relaxed">
                Diese erweiterten Berechnungen basieren auf wissenschaftlichen Modellen und sind deutlich genauer als einfache Schätzungen. 
                Dennoch ersetzen sie NICHT veröffentlichte Ladedaten von Herstellern. Beginnen Sie immer mit reduzierten Ladungen 
                und arbeiten Sie sich vorsichtig nach oben. Der Benutzer trägt die volle Verantwortung für die Sicherheit beim Wiederladen. 
                Konsultieren Sie immer aktuelle Ladehandbücher und befolgen Sie alle Sicherheitsvorschriften.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AdvancedBallisticsCalculator;
